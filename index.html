<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>RLE Compression 1</title>
    <style>
        body {
            padding-top: 50px;
        }

        .jumbotron {
            padding-top: 6rem;
        }

        .background-header {
            background-image: url("img/5559852.jpg");
            background-color: #fafbfc;
            height: 490px;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            position: relative;
        }

        .blue {
            background-color: rgb(38, 38, 124);
        }

        .btn-primer {
            background-color: rgb(39, 39, 75);
        }

        .btn-primer:hover {
            background-color: rgb(59, 59, 134);
        }

        /* Service */
        .service-style {
            margin-top: 6px;
            background-color: #fafbfc;
        }
        .secret-btn{
            color: white;
        }
    </style>
</head>

<body>

    <!-- RLE COMPRESION DATA TIDAK BERURUT -->
    <!-- Navbar -->
    <nav class="navbar fixed-top shadow-lg blue">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1 text-white">RLE Compression 1</span>
            <a href="index2.html">RLE2</a>
        </div>
    </nav>

    <!-- Jumbotron -->
    <header class="jumbotron jumbotron-fluid background-header d-flex">
        <div class="container-fluid text-center">
            <h1 class="display-2" style="color: aliceblue;">Simulasi Kompresi File Teks <span style="color: aqua;">RLE</span></h1>
            <p class="lead" style="font-weight: bold; color: #fff;">Masukkan File text anda dengan ekstensi "txt"</p>
            <div class="mb-3 w-50 ms-auto me-auto">
                <input class="form-control" type="file" id="fileInput" accept=".txt">
            </div>
            <button class="fw-bold btn btn-lg text-white btn-primer" id="compressButton">Kompresi</button>
        </div>
    </header>

    <!-- Hasil Kompresi -->
    <section id="hasilKompresi" class="container-fluid service-style">
        <div class="row text-center">
            <div class="col-12 mb-5 mt-2 pt-3">
                <h2 class="display-4" style="margin-top: 3rem!important;">Hasil Kompresi</h2>
            </div>
        </div>

        <div class="row text-center w-75 mx-auto">
            <div class="col-12 col-sm-6 col-lg-6">
                <ul class="list-group">
                    <li class="list-group-item active h4" aria-current="true">File Original</li>
                    <li class="list-group-item"><p id="originalData">Data asli</p></li>
                    <li class="list-group-item"><p id="originalSize">Ukuran data asli</p></li>
                    <li class="list-group-item"><p id="originalSizeBytes">Ukuran data asli</p></li>
                    <li class="list-group-item"><p id="originalTime">Waktu pengiriman data asli</p></li>
                  </ul>
            </div>


        

            <div class="col-12 col-sm-6 col-lg-6">
                <ul class="list-group">
                    <li class="list-group-item active h4" aria-current="true">File Kompresi</li>
                    <li class="list-group-item"><p id="compressedData">Data setelah kompresi</p></li>
                    <li class="list-group-item"><p id="compressedSize">Ukuran data terkompresi</p></li>
                    <li class="list-group-item"><p id="compressedSizeBytes">Ukuran data terkompresi</p></li>
                    <li class="list-group-item"><p id="compressedTime">Waktu pengiriman data terkompresi</p></li>
                  </ul>
            </div>
        </div>

        <div class="row text-center">
            <div class="col-12 mb-5 mt-2 pt-3">
                <h3 id="sizeReduction" ></h3> 
                <h3 id="ByteReduction"></h3>
                <a id="downloadLink" class="btn btn-primary w-25 mx-auto" style="display: none;">Download Kompresi</a>
            </div>
            <button id="toggleDecompressSection" class="btn secret-btn mb-4 w-50 mx-auto">Tampilkan Dekompresi</button> <!-- Tombol tersembunyi -->

        </div>

    </section>

<!-- Dekompresi -->

    <section id="hasilDekompresi" style="display:none" class="container-fluid text-center mb-4">
        <h2 class="display-4 mb-4" style="margin-top: 3rem!important;">Hasil DeKompresi</h2>

        <h2>Unggah File Terkompresi untuk Dekompress:</h2>
        <div class="mb-3 w-50 ms-auto me-auto">
            <input class="form-control" type="file" id="compressedFileInput" accept=".txt">
        </div>
        <button id="decompressButton" class="btn btn-primer w-25 text-white">Dekompresi</button>
        <h2 class="mt-4">Hasil Dekompresi:</h2>
        <p id="decompressResult"></p>
        <a id="downloadDecompressLink" class="btn btn-primary w-25 mx-auto" style="display: none;">Download Dekompresi</a> <!-- Tautan unduh untuk dekompresi -->
    </section>



    <footer class="bg-dark mt-4">
        <div class="col-lg-12" style="padding: 10px;">
            <p class="text-center text-secondary">Copyright &copy; JohnsonLiu 2024</p>
        </div>
    </footer>






    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    <script>
        // Fungsi Kompresi untuk menangani karakter tidak berurutan
        function rleCompress(data) {
            const charCount = {};
            let compressed = '';

            // Menghitung frekuensi kemunculan setiap karakter
            for (const char of data) {
                charCount[char] = (charCount[char] || 0) + 1;
            }

            // Menyusun string terkompresi
            for (const char in charCount) {
                compressed += char + (charCount[char] > 1 ? charCount[char] : '');
            }

            return compressed;
        }

        // Fungsi Dekompresi RLE
        function rleDecompress(data) {
            let decompressed = '';
            let i = 0;

            while (i < data.length) {
                const char = data[i];
                i++;
                let count = '';

                // Mendapatkan angka yang merupakan jumlah kemunculan karakter
                while (i < data.length && !isNaN(data[i])) {
                    count += data[i];
                    i++;
                }

                // Jika tidak ada angka setelah karakter, anggap jumlah kemunculan adalah 1
                const repeatCount = count ? parseInt(count) : 1;
                decompressed += char.repeat(repeatCount);
            }

            return decompressed;
        }

        function simulateTransmission(size) {
            const speed = 1000; // karakter per detik
            return size / speed; // waktu dalam detik
        }

        document.getElementById('compressButton').addEventListener('click', function () {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                alert("Silakan unggah file teks terlebih dahulu.");
                return;
            }

            const reader = new FileReader();
            reader.onload = function (event) {
                const content = event.target.result;
                const compressedData = rleCompress(content);

                // Menghitung ukuran dan waktu pengiriman
                const originalSize = content.length;
                const compressedSize = compressedData.length;

                const originalTransmissionTime = simulateTransmission(originalSize);
                const compressedTransmissionTime = simulateTransmission(compressedSize);

                // Menghitung ukuran dalam byte
                const originalSizeBytes = file.size; // Ukuran file asli dalam byte
                const compressedSizeBytes = new Blob([compressedData]).size; // Ukuran file terkompresi dalam byte

                // Menampilkan hasil kompresi
                document.getElementById('originalData').textContent = content;
                document.getElementById('compressedData').textContent = compressedData;
                document.getElementById('originalSize').textContent = `Ukuran asli: ${originalSize} karakter`;
                document.getElementById('compressedSize').textContent = `Ukuran terkompresi: ${compressedSize} karakter`;
                document.getElementById('originalSizeBytes').textContent = `Ukuran asli: ${originalSizeBytes} byte`;
                document.getElementById('compressedSizeBytes').textContent = `Ukuran terkompresi: ${compressedSizeBytes} byte`;
                document.getElementById('originalTime').textContent = `Waktu pengiriman data asli: ${originalTransmissionTime.toFixed(2)} detik`;
                document.getElementById('compressedTime').textContent = `Waktu pengiriman data terkompresi: ${compressedTransmissionTime.toFixed(2)} detik`;
                document.getElementById('sizeReduction').textContent = `Pengurangan karakter: ${originalSize - compressedSize} karakter`;
                document.getElementById('ByteReduction').textContent = `Pengurangan ukuran: ${originalSizeBytes - compressedSizeBytes} byte`;


                
                // Menyediakan tautan untuk mengunduh file terkompresi
                const blob = new Blob([compressedData], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const downloadLink = document.getElementById('downloadLink');
                downloadLink.href = url;
                downloadLink.download = 'compressed.txt';
                downloadLink.style.display = 'block'; // Tampilkan tautan unduh
            };

            reader.readAsText(file);
        });

        document.getElementById('decompressButton').addEventListener('click', function () {
            const compressedFileInput = document.getElementById('compressedFileInput');
            const file = compressedFileInput.files[0];

            if (!file) {
                alert("Silakan unggah file terkompresi terlebih dahulu.");
                return;
            }

            const reader = new FileReader();
            reader.onload = function (event) {
                const compressedContent = event.target.result;
                const decompressedData = rleDecompress(compressedContent);

                // Menampilkan hasil dekompresi
                document.getElementById('decompressResult').textContent = decompressedData;

                // Menyediakan tautan untuk mengunduh file terdekompresi
                const decompressedBlob = new Blob([decompressedData], { type: 'text/plain' });
                const decompressedUrl = URL.createObjectURL(decompressedBlob);
                const downloadDecompressLink = document.getElementById('downloadDecompressLink');
                downloadDecompressLink.href = decompressedUrl;
                downloadDecompressLink.download = 'decompressed.txt';
                downloadDecompressLink.style.display = 'block'; // Tampilkan tautan unduh
            };

            reader.readAsText(file);
        });


         // Fungsi untuk menyembunyikan/ menampilkan section dekompresi
    document.getElementById('toggleDecompressSection').addEventListener('click', function() {
        const decompressSection = document.getElementById('hasilDekompresi');
        // Toggle visibilitas
        if (decompressSection.style.display === 'none') {
            decompressSection.style.display = 'block';
        } else {
            decompressSection.style.display = 'none';
        }
    });
    </script>
</body>

</html>
